<html>
  <head>
    <title>simonvc's Minimal Monitoring tool for Riak 1.2</title>


    <script type="text/JavaScript" src="http://code.jquery.com/jquery.js"></script>
    <script language="javascript" type="text/javascript" src="/riak/minmon/jquery.jqplot.min.js"></script>


  </head>
  <body>
    <center><h1>Your Cluster</h1></center>

    <form name="recording_form">
      <input type="checkbox" name="recording" value="Recording">Monitoring<br>
    </form>


    This is a <div id="cluster_size">?</div> node cluster. <br/><br/>
    This node is connected to <div id="cluster_connected">?</div> other nodes are currently connected.<br/>
    <br/>
    <div>The other nodes in this cluster: </div>
    <div id="cluster_links"></div><br/>

    <div>This node has served </div><div id="node_gets"></div> since it was restarted.<br/>

    A total of of <div id="node_gets_total"></div> gets have been served by the whole cluster.<br/>



    <h2> CPU Usage of this Node</h2>
    <div id="chart1" style="height:300px; width:500px;"></div>

  <script type="text/JavaScript">
   var arr = new Array;
   arr.push(1);
   var plot1 = $.jqplot ('chart1', [arr]);
  </script>

<h2>milestones</h2>


<li> can use JS from this html to get /stats json and display

<li> I can turn recording off and on with a checkbox

<li> I can plot the array

<li> http://stackoverflow.com/questions/10420352/converting-file-size-in-bytes-to-human-readable

<script type="text/JavaScript" >
  console.log("hello world");
  function everyFewSeconds() {
      if ( $('input[name=recording]').is(':checked') ) {
        $.getJSON('/stats', function(data) {
            arr.push(data.cpu_avg1);
            arr=arr.slice(-60)
            console.log("arr "+arr); 
            var plot1 = $.jqplot ('chart1', [arr]);
            plot1.replot();
// update the node list
            document.getElementById('cluster_links').innerHTML = data.ring_members;
            document.getElementById('cluster_size').innerHTML = data.ring_members.length;
            document.getElementById('cluster_connected').innerHTML = data.connected_nodes.length+1;
            } )
       } // end of if
   //console.log("about to start the everyFewSeconds timer");
   setTimeout(everyFewSeconds, 5000);
    }
 </script>

 <script type="text/JavaScript">
   everyFewSeconds();
 </script>


 
  </body>
</html>
